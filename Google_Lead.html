<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Google Lead Performance Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<style>
:root {
  --void:#020308; --surf:rgba(255,255,255,.035); --glass:rgba(255,255,255,.06);
  --rim:rgba(255,255,255,.08); --rim2:rgba(255,255,255,.18);
  --cyan:#00f5ff; --blue:#4f8eff; --violet:#a855f7;
  --pink:#f472b6; --amber:#fbbf24; --lime:#a3e635; --green:#10b981;
  --red:#f43f5e; --white:#f1f5f9; --muted:#64748b; --dim:#334155;
  --m0:#00f5ff; --m1:#a3e635; --m2:#f472b6; --m3:#fbbf24;
  --font:'Plus Jakarta Sans',sans-serif;
  --r:16px; --r2:20px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:var(--font);background:var(--void);color:var(--white);min-height:100vh;overflow-x:hidden;font-weight:500;}

/* AURORA BG */
.aurora{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;}
.aurora::before{content:'';position:absolute;width:120vw;height:120vw;top:-40vw;left:-20vw;background:radial-gradient(ellipse,rgba(79,142,255,.1) 0%,transparent 65%);animation:drift1 18s ease-in-out infinite alternate;}
.aurora::after{content:'';position:absolute;width:100vw;height:100vw;bottom:-30vw;right:-20vw;background:radial-gradient(ellipse,rgba(168,85,247,.08) 0%,transparent 65%);animation:drift2 22s ease-in-out infinite alternate;}
@keyframes drift1{0%{transform:translate(0,0) scale(1)}100%{transform:translate(5vw,8vh) scale(1.15)}}
@keyframes drift2{0%{transform:translate(0,0) scale(1)}100%{transform:translate(-8vw,-5vh) scale(1.2)}}
body::after{content:'';position:fixed;inset:0;z-index:0;background-image:linear-gradient(rgba(79,142,255,.035) 1px,transparent 1px),linear-gradient(90deg,rgba(79,142,255,.035) 1px,transparent 1px);background-size:48px 48px;pointer-events:none;mask-image:radial-gradient(ellipse 80% 80% at 50% 50%,black,transparent);}

/* ‚ïê‚ïê LOADER ‚ïê‚ïê */
#loader{position:fixed;inset:0;z-index:9999;background:var(--void);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;transition:opacity .5s ease;}
#loader.fade-out{opacity:0;pointer-events:none;}

.ld-icon-wrap{position:relative;width:58px;height:58px;display:flex;align-items:center;justify-content:center;}
.ld-icon-bg{position:absolute;inset:0;border-radius:14px;background:linear-gradient(145deg,#f05a1a 0%,#c0340a 50%,#8b1a0a 100%);box-shadow:0 8px 24px rgba(232,80,10,.45),0 0 0 1px rgba(255,255,255,.1);animation:bob 2.2s ease-in-out infinite;}
@keyframes bob{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-5px) scale(1.03)}}
.ld-icon-glyph{position:relative;z-index:2;font-size:28px;line-height:1;}
.ld-ring{position:absolute;inset:-6px;border-radius:20px;border:2px solid transparent;border-top-color:rgba(240,90,26,.7);border-right-color:rgba(240,90,26,.3);animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}

.ld-title{font-size:18px;font-weight:800;color:var(--white);letter-spacing:-.3px;text-align:center;}


.ld-bar-wrap{width:200px;height:3px;background:rgba(255,255,255,.07);border-radius:3px;overflow:hidden;}
.ld-bar{height:100%;width:0%;background:linear-gradient(90deg,#f05a1a,#ff8c4a);border-radius:3px;transition:width .4s cubic-bezier(.16,1,.3,1);box-shadow:0 0 10px rgba(240,90,26,.5);}

#lmsg{font-size:12px;font-weight:600;color:var(--muted);letter-spacing:.3px;}

#errmsg{display:none;max-width:480px;padding:24px 28px;background:rgba(244,63,94,.06);border:1px solid rgba(244,63,94,.25);border-radius:var(--r2);color:#fda4af;font-size:13px;line-height:1.8;text-align:center;}
#errmsg strong{color:#fff;}
#errmsg a{color:var(--cyan);}
#errmsg .retry-btn{display:inline-block;margin-top:12px;padding:8px 20px;background:rgba(240,90,26,.15);border:1px solid rgba(240,90,26,.4);border-radius:10px;color:#ff8c4a;cursor:pointer;font-weight:700;font-family:var(--font);font-size:13px;}

/* ‚ïê‚ïê HEADER ‚ïê‚ïê */
header{position:sticky;top:0;z-index:200;background:rgba(2,3,8,.9);backdrop-filter:blur(24px);border-bottom:1px solid var(--rim);padding:0 28px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;min-height:62px;position:relative;}
header::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--cyan),transparent);opacity:.3;}
.brand{display:flex;align-items:center;gap:12px;}
.brand-icon{width:36px;height:36px;border-radius:11px;background:linear-gradient(145deg,#f05a1a,#c0340a,#8b1a0a);display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 0 0 1px rgba(240,90,26,.3),0 6px 20px rgba(240,90,26,.25);}
.brand-text span{display:block;font-size:10px;font-weight:700;color:var(--cyan);margin-bottom:1px;}
.brand-text strong{font-size:16px;font-weight:800;color:var(--white);}
.hright{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.live-badge{display:flex;align-items:center;gap:6px;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);border-radius:20px;padding:4px 12px;font-size:11px;font-weight:700;color:var(--green);}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);animation:livep 1.8s ease-in-out infinite;}
@keyframes livep{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.2;transform:scale(.6)}}
#sname{font-size:11px;font-weight:600;color:var(--cyan);background:rgba(0,245,255,.06);border:1px solid rgba(0,245,255,.18);border-radius:20px;padding:4px 12px;}
#rts{font-size:11px;font-weight:500;color:var(--muted);}
.btn-refresh{display:flex;align-items:center;gap:6px;background:rgba(79,142,255,.12);border:1px solid rgba(79,142,255,.3);color:#93c5fd;border-radius:10px;padding:7px 14px;cursor:pointer;font-size:12px;font-weight:700;font-family:var(--font);transition:all .2s;}
.btn-refresh:hover{background:rgba(79,142,255,.25);color:#fff;transform:translateY(-1px);box-shadow:0 4px 16px rgba(79,142,255,.25);}
.btn-refresh:disabled{opacity:.5;cursor:not-allowed;transform:none;}
.spin-icon{display:inline-block;transition:transform .35s;}
.btn-refresh:not(:disabled):hover .spin-icon{transform:rotate(180deg);}

/* ‚ïê‚ïê TABS ‚ïê‚ïê */
.tabs{display:flex;gap:2px;background:rgba(255,255,255,.04);border-radius:12px;padding:4px;border:1px solid var(--rim);}
.tab{padding:7px 16px;border-radius:9px;border:none;background:transparent;color:var(--muted);cursor:pointer;font-size:13px;font-weight:700;font-family:var(--font);transition:all .22s;white-space:nowrap;position:relative;overflow:hidden;}
.tab.on{background:linear-gradient(135deg,var(--cyan),var(--blue));color:#000;font-weight:800;box-shadow:0 4px 18px rgba(0,245,255,.3);}
.tab:hover:not(.on){color:var(--white);background:rgba(255,255,255,.07);}

/* ‚ïê‚ïê SORT + FILTERS ‚ïê‚ïê */
.top-controls{display:flex;align-items:center;gap:10px;padding:10px 28px;background:rgba(255,255,255,.012);border-bottom:1px solid var(--rim);position:relative;z-index:1;flex-wrap:wrap;}
.sort-group{display:flex;align-items:center;gap:5px;background:rgba(255,255,255,.03);border:1px solid var(--rim);border-radius:10px;padding:4px;}
.sort-lbl{font-size:11px;font-weight:700;color:var(--muted);padding:0 6px;}
.sbtn{background:transparent;border:none;color:var(--muted);border-radius:7px;padding:5px 13px;cursor:pointer;font-size:12px;font-weight:700;font-family:var(--font);transition:all .2s;white-space:nowrap;}
.sbtn.on{background:linear-gradient(135deg,var(--cyan),var(--blue));color:#000;box-shadow:0 2px 10px rgba(0,245,255,.25);}
.sbtn:hover:not(.on){color:var(--white);background:rgba(255,255,255,.07);}
.filters{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-left:auto;}
.fg{position:relative;}
.fg label{position:absolute;top:-8px;left:10px;z-index:1;font-size:10px;font-weight:700;color:var(--cyan);background:var(--void);padding:0 4px;}
.fg select{background:rgba(255,255,255,.04);border:1px solid var(--rim);border-radius:10px;color:var(--white);padding:8px 32px 8px 12px;font-size:12px;font-weight:600;font-family:var(--font);outline:none;cursor:pointer;min-width:130px;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%2300f5ff'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;transition:border-color .2s;}
.fg select:hover,.fg select:focus{border-color:rgba(0,245,255,.4);}
.fg select:disabled{opacity:.35;cursor:not-allowed;}
option{background:#080c1a;}
.btn-reset{background:transparent;border:1px solid var(--rim);border-radius:10px;color:var(--muted);padding:8px 14px;cursor:pointer;font-size:12px;font-weight:700;font-family:var(--font);transition:all .2s;}
.btn-reset:hover{border-color:var(--red);color:var(--red);}

/* ‚ïê‚ïê KPIs ‚ïê‚ïê */
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;padding:18px 28px;position:relative;z-index:1;}
.kpi{position:relative;border-radius:var(--r2);padding:22px 24px;background:var(--surf);border:1px solid var(--rim);overflow:hidden;cursor:default;transition:transform .3s,box-shadow .3s,border-color .3s;}
.kpi:hover{transform:translateY(-4px);box-shadow:0 20px 50px rgba(0,0,0,.4);}
.kpi-glow{position:absolute;inset:0;opacity:0;transition:opacity .4s;border-radius:var(--r2);}
.kpi:hover .kpi-glow{opacity:1;}
.k0:hover{border-color:rgba(0,245,255,.3);} .k0 .kpi-glow{background:radial-gradient(ellipse at top left,rgba(0,245,255,.08),transparent 70%);}
.k1:hover{border-color:rgba(163,230,53,.3);} .k1 .kpi-glow{background:radial-gradient(ellipse at top left,rgba(163,230,53,.08),transparent 70%);}
.k2:hover{border-color:rgba(244,114,182,.3);} .k2 .kpi-glow{background:radial-gradient(ellipse at top left,rgba(244,114,182,.08),transparent 70%);}
.k3:hover{border-color:rgba(251,191,36,.3);}  .k3 .kpi-glow{background:radial-gradient(ellipse at top left,rgba(251,191,36,.08),transparent 70%);}
.kpi-stripe{position:absolute;top:0;left:0;right:0;height:2px;border-radius:var(--r2) var(--r2) 0 0;}
.k0 .kpi-stripe{background:linear-gradient(90deg,var(--cyan),transparent);}
.k1 .kpi-stripe{background:linear-gradient(90deg,var(--lime),transparent);}
.k2 .kpi-stripe{background:linear-gradient(90deg,var(--pink),transparent);}
.k3 .kpi-stripe{background:linear-gradient(90deg,var(--amber),transparent);}
.kpi-icon{position:absolute;top:18px;right:20px;font-size:26px;opacity:.14;transition:opacity .3s,transform .3s;}
.kpi:hover .kpi-icon{opacity:.38;transform:scale(1.18) rotate(-8deg);}
.kpi-label{font-size:12px;font-weight:700;color:var(--muted);margin-bottom:9px;}
.k0 .kpi-label{color:var(--cyan);} .k1 .kpi-label{color:var(--lime);} .k2 .kpi-label{color:var(--pink);} .k3 .kpi-label{color:var(--amber);}
.kpi-val{font-size:44px;font-weight:900;color:var(--white);line-height:1;letter-spacing:-2px;font-variant-numeric:tabular-nums;}
.kpi-sub{font-size:12px;color:var(--muted);margin-top:7px;font-weight:600;}

/* ‚ïê‚ïê CONTENT ‚ïê‚ïê */
.content{padding:0 28px 48px;position:relative;z-index:1;}
.section{animation:fadeUp .35s ease both;}
.section.hidden{display:none!important;}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.card{background:var(--surf);border:1px solid var(--rim);border-radius:var(--r2);padding:26px;transition:border-color .25s;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);}
.card:hover{border-color:var(--rim2);}
.card-title{display:flex;align-items:center;gap:10px;font-size:14px;font-weight:800;color:var(--white);margin-bottom:22px;}
.ct-bar{width:3px;height:14px;border-radius:2px;background:linear-gradient(180deg,var(--cyan),var(--blue));flex-shrink:0;}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.full{grid-column:1/-1;}
.nodata{color:var(--muted);text-align:center;padding:50px;font-size:13px;font-weight:600;}

/* ‚ïê‚ïê MANAGER BARS ‚ïê‚ïê */
.mbar{margin-bottom:20px;} .mbar:last-child{margin-bottom:0;}
.mbar-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.mbar-name{display:flex;align-items:center;gap:10px;font-size:14px;font-weight:700;}
.mbar-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;position:relative;}
.mbar-dot::after{content:'';position:absolute;inset:-4px;border-radius:50%;background:inherit;opacity:.2;animation:dotp 2s ease-in-out infinite;}
@keyframes dotp{0%,100%{transform:scale(1)}50%{transform:scale(1.7)}}
.mbar-badges{display:flex;gap:6px;}
.bdg{display:inline-block;border-radius:20px;padding:3px 11px;font-size:11px;font-weight:700;}
.track{background:rgba(255,255,255,.05);border-radius:6px;height:8px;overflow:hidden;position:relative;}
.track-fill{position:absolute;inset-block:0;left:0;border-radius:6px;width:0;transition:width 1.1s cubic-bezier(.16,1,.3,1);}
.track-ach{position:absolute;top:2px;bottom:2px;left:0;border-radius:4px;width:0;transition:width 1.3s cubic-bezier(.16,1,.3,1);}

/* ‚ïê‚ïê TREND ‚ïê‚ïê */
.tchart{display:flex;flex-direction:column;gap:11px;}
.tc-label{display:flex;justify-content:space-between;font-size:12px;margin-bottom:5px;font-weight:600;}
.tc-label span{color:var(--muted);}
.tc-bar-wrap{position:relative;height:11px;background:rgba(255,255,255,.04);border-radius:7px;overflow:hidden;}
.tc-bar{position:absolute;inset-block:0;left:0;border-radius:7px;width:0;transition:width 1.1s cubic-bezier(.16,1,.3,1);}
.tc-ach{position:absolute;top:3px;bottom:3px;left:0;border-radius:5px;width:0;background:linear-gradient(90deg,var(--lime),var(--green));opacity:.85;transition:width 1.3s cubic-bezier(.16,1,.3,1);}

/* ‚ïê‚ïê TOP 5 ‚ïê‚ïê */
.top5{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;}
.tc{border-radius:18px;padding:20px;position:relative;overflow:hidden;border:1px solid var(--rim);transition:transform .3s,box-shadow .3s;cursor:default;}
.tc:hover{transform:translateY(-6px);}
.tc-shine{position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.07),transparent 50%);border-radius:18px;pointer-events:none;}
.tc-rank{font-size:11px;font-weight:700;color:var(--muted);margin-bottom:6px;}
.tc-name{font-size:14px;font-weight:800;color:var(--white);margin-bottom:3px;line-height:1.3;}
.tc-mgr{font-size:11px;font-weight:600;color:var(--muted);margin-bottom:14px;}
.tc-num{font-size:34px;font-weight:900;line-height:1;letter-spacing:-1px;}
.tc-cv{font-size:11px;font-weight:700;color:var(--green);margin-top:5px;}

/* ‚ïê‚ïê TABLES ‚ïê‚ïê */
.table-wrap{border-radius:var(--r2);border:1px solid var(--rim);overflow:hidden;}
table{width:100%;border-collapse:collapse;}
thead tr{background:rgba(0,245,255,.05);border-bottom:1px solid rgba(0,245,255,.1);}
th{padding:13px 16px;text-align:left;font-size:12px;font-weight:800;color:var(--white);white-space:nowrap;cursor:pointer;user-select:none;transition:color .2s;}
th:hover{color:var(--cyan);}
th.active-sort{color:var(--cyan);}
.sort-arrow{opacity:.4;margin-left:4px;}
th.active-sort .sort-arrow{opacity:1;}
td{padding:12px 16px;border-top:1px solid rgba(255,255,255,.04);font-size:13px;font-weight:500;color:var(--white);}
tbody tr{transition:background .15s;}
tbody tr:hover td{background:rgba(255,255,255,.03);}
.num-big{font-size:21px;font-weight:900;font-variant-numeric:tabular-nums;}
.cv-row{display:flex;align-items:center;gap:10px;}
.cv-track{flex:1;height:5px;background:rgba(255,255,255,.06);border-radius:4px;max-width:65px;}
.cv-fill{height:100%;border-radius:4px;}
.rank-pill{font-size:11px;font-weight:700;color:var(--muted);background:rgba(255,255,255,.05);border-radius:7px;padding:2px 9px;min-width:28px;text-align:center;}

/* ‚ïê‚ïê PROCESS ‚ïê‚ïê */
.pgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}
.pc{background:var(--surf);border:1px solid var(--rim);border-radius:var(--r2);padding:22px;position:relative;overflow:hidden;transition:all .3s;}
.pc:hover{transform:translateY(-4px);}
.pc-glow{position:absolute;top:-40px;right:-40px;width:120px;height:120px;border-radius:50%;opacity:.07;filter:blur(20px);transition:opacity .3s;}
.pc:hover .pc-glow{opacity:.2;}
.pc-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;}
.pc-title{font-size:16px;font-weight:800;color:var(--white);}
.pc-nums{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;}
.pc-lbl{font-size:10px;font-weight:700;color:var(--muted);letter-spacing:.5px;text-transform:uppercase;margin-bottom:3px;}
.pc-val{font-size:26px;font-weight:900;letter-spacing:-1px;}
.pc-prog{background:rgba(255,255,255,.05);border-radius:4px;height:4px;overflow:hidden;}
.pc-prog-fill{height:100%;border-radius:4px;transition:width 1.1s cubic-bezier(.16,1,.3,1);}

/* ‚ïê‚ïê CALENDAR ‚ïê‚ïê */
.cal-layout{display:grid;grid-template-columns:1fr 280px;gap:14px;}
.cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px;}
.cal-nav-btn{width:36px;height:36px;border-radius:10px;background:rgba(255,255,255,.05);border:1px solid var(--rim);color:var(--muted);cursor:pointer;font-size:18px;line-height:1;display:flex;align-items:center;justify-content:center;transition:all .2s;font-family:var(--font);}
.cal-nav-btn:hover{background:rgba(0,245,255,.1);border-color:rgba(0,245,255,.3);color:var(--cyan);}
.cal-month{font-size:24px;font-weight:900;color:var(--white);text-align:center;letter-spacing:-.5px;}
.cal-yr{font-size:11px;font-weight:600;color:var(--muted);text-align:center;margin-top:2px;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.cal-dh{text-align:center;font-size:10px;font-weight:800;color:var(--muted);padding:4px 0;letter-spacing:.5px;}
.cal-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:9px;cursor:pointer;font-size:13px;font-weight:600;border:1px solid transparent;transition:all .15s;position:relative;}
.cal-day:hover:not(.empty){background:rgba(255,255,255,.07);}
.cal-day.has{background:rgba(0,245,255,.07);color:var(--cyan);border-color:rgba(0,245,255,.2);}
.cal-day.sel{background:linear-gradient(135deg,var(--cyan),var(--blue));color:#000;font-weight:900;box-shadow:0 4px 14px rgba(0,245,255,.35);}
.cal-day.empty{cursor:default;}
.cal-dot{position:absolute;bottom:3px;width:4px;height:4px;border-radius:50%;background:var(--cyan);}
.cal-legend{display:flex;gap:18px;margin-top:14px;justify-content:center;}
.cal-leg{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:600;color:var(--muted);}
.cal-leg-box{width:11px;height:11px;border-radius:4px;}
.cal-side{display:flex;flex-direction:column;gap:12px;}
.wk-item{padding:11px 13px;margin-bottom:5px;background:rgba(0,245,255,.04);border-radius:10px;border-left:3px solid var(--cyan);transition:all .2s;}
.wk-item:hover{background:rgba(0,245,255,.08);}
.wk-name{font-size:13px;font-weight:800;color:var(--cyan);margin-bottom:2px;}
.wk-dates{font-size:11px;font-weight:500;color:var(--muted);}
.sel-scroll{max-height:155px;overflow-y:auto;}
.sel-scroll::-webkit-scrollbar{width:3px;}
.sel-scroll::-webkit-scrollbar-thumb{background:var(--dim);border-radius:2px;}
.sel-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:12px;font-weight:600;}
.sel-rm{background:none;border:none;color:var(--muted);cursor:pointer;font-size:18px;line-height:1;transition:color .2s;}
.sel-rm:hover{color:var(--red);}
.btn-clr{margin-top:9px;width:100%;padding:8px;background:rgba(244,63,94,.08);border:1px solid rgba(244,63,94,.2);border-radius:10px;color:var(--red);cursor:pointer;font-size:12px;font-weight:700;font-family:var(--font);transition:all .2s;}
.btn-clr:hover{background:rgba(244,63,94,.15);}

::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--dim);border-radius:3px;}

@media(max-width:1100px){
  .kpis{grid-template-columns:1fr 1fr;}
  .g2,.top5,.pgrid,.cal-layout{grid-template-columns:1fr;}
  .full{grid-column:1;}
  header,.kpis,.content,.top-controls{padding-left:14px;padding-right:14px;}
}
@media(max-width:600px){
  .kpis{grid-template-columns:1fr;}
  .top5{grid-template-columns:1fr 1fr;}
  .pgrid{grid-template-columns:1fr;}
  .tabs .tab{padding:6px 11px;font-size:12px;}
}
</style>
</head>
<body>

<div class="aurora"></div>

<!-- ‚ïê‚ïê LOADER ‚ïê‚ïê -->
<div id="loader">
  <div class="ld-icon-wrap">
    <div class="ld-icon-bg"></div>
    <span class="ld-icon-glyph">üéì</span>
    <div class="ld-ring"></div>
  </div>
  <div class="ld-title">Google Lead Performance</div>
  
  <div class="ld-bar-wrap"><div class="ld-bar" id="lbar"></div></div>
  <div id="errmsg"></div>
</div>

<!-- ‚ïê‚ïê HEADER ‚ïê‚ïê -->
<header>
  <div class="brand">
    <div class="brand-icon">üéì</div>
    <div class="brand-text">
      <strong>Google Lead Performance</strong>
    </div>
  </div>
  <div class="hright">
    <div class="live-badge"><span class="live-dot"></span>LIVE</div>
<button class="btn-refresh" onclick="loadData()" id="refreshBtn">
      <span class="spin-icon">‚Üª</span> Refresh
    </button>
  </div>
  <div class="tabs">
    <button class="tab on"  onclick="go('overview')">Overview</button>
    <button class="tab"     onclick="go('managers')">Managers</button>
    <button class="tab"     onclick="go('counsellors')">Counsellors</button>
    <button class="tab"     onclick="go('process')">Process</button>
    <button class="tab"     onclick="go('calendar')">Calendar</button>
  </div>
</header>

<!-- ‚ïê‚ïê SORT + FILTERS ‚ïê‚ïê -->
<div class="top-controls">
  <div class="sort-group">
    <span class="sort-lbl">Sort By</span>
    <button class="sbtn on" id="sb_ratio" onclick="setSort('ratio')">‚Üì Conv Rate</button>
    <button class="sbtn"    id="sb_r"     onclick="setSort('r')">Leads Rcv</button>
    <button class="sbtn"    id="sb_a"     onclick="setSort('a')">Apps Ach</button>
  </div>
  <div class="filters">
    <div class="fg"><label>Month</label>
      <select id="fm" onchange="onMonth()"><option value="">All Months</option></select></div>
    <div class="fg"><label>Week</label>
      <select id="fw" onchange="render()" disabled><option value="">All Weeks</option></select></div>
    <div class="fg"><label>Manager</label>
      <select id="fmg" onchange="onMgr()"><option value="">All Managers</option></select></div>
    <div class="fg"><label>Process</label>
      <select id="fp" onchange="render()"><option value="">All Processes</option></select></div>
    <div class="fg"><label>Counsellor</label>
      <select id="fc" onchange="render()"><option value="">All Counsellors</option></select></div>
    <button class="btn-reset" onclick="resetF()">‚úï Reset</button>
  </div>
</div>

<!-- ‚ïê‚ïê KPIs ‚ïê‚ïê -->
<div class="kpis">
  <div class="kpi k0"><div class="kpi-glow"></div><div class="kpi-stripe"></div><div class="kpi-icon">üì•</div>
    <div class="kpi-label">Leads Received</div><div class="kpi-val" id="kv1">‚Äî</div><div class="kpi-sub" id="ks1">records</div></div>
  <div class="kpi k1"><div class="kpi-glow"></div><div class="kpi-stripe"></div><div class="kpi-icon">‚úÖ</div>
    <div class="kpi-label">Apps Achieved</div><div class="kpi-val" id="kv2">‚Äî</div><div class="kpi-sub">converted</div></div>
  <div class="kpi k2"><div class="kpi-glow"></div><div class="kpi-stripe"></div><div class="kpi-icon">üìà</div>
    <div class="kpi-label">Conversion Rate</div><div class="kpi-val" id="kv3">‚Äî</div><div class="kpi-sub">rcv ‚Üí ach</div></div>
  <div class="kpi k3"><div class="kpi-glow"></div><div class="kpi-stripe"></div><div class="kpi-icon">üë•</div>
    <div class="kpi-label">Active Managers</div><div class="kpi-val" id="kv4">‚Äî</div><div class="kpi-sub" id="ks4">teams</div></div>
</div>

<!-- ‚ïê‚ïê CONTENT ‚ïê‚ïê -->
<div class="content">

  <div id="tab-overview" class="section">
    <div class="g2">
      <div class="card"><div class="card-title"><span class="ct-bar"></span>Manager Performance</div><div id="mgrbars"></div></div>
      <div class="card"><div class="card-title"><span class="ct-bar"></span>Weekly Lead Trend</div><div class="tchart" id="trend"></div></div>
      <div class="card full"><div class="card-title"><span class="ct-bar"></span>Top Counsellors ¬∑ Sorted by Conv Rate</div><div class="top5" id="topcards"></div></div>
    </div>
  </div>

  <div id="tab-managers" class="section hidden">
    <div class="table-wrap"><table>
      <thead><tr>
        <th>Manager</th>
        <th id="th_r" onclick="setSort('r')">Received <span class="sort-arrow">‚Üï</span></th>
        <th id="th_a" onclick="setSort('a')">Achieved <span class="sort-arrow">‚Üï</span></th>
        <th id="th_ratio" onclick="setSort('ratio')" class="active-sort">Conv % <span class="sort-arrow">‚Üì</span></th>
        <th>Progress</th><th>Processes</th>
      </tr></thead>
      <tbody id="mgrtbody"></tbody>
    </table></div>
  </div>

  <div id="tab-counsellors" class="section hidden">
    <div class="table-wrap"><table>
      <thead><tr>
        <th>#</th><th>Counsellor</th><th>Manager</th><th>Team Leader</th>
        <th id="th2_r" onclick="setSort('r')">Received <span class="sort-arrow">‚Üï</span></th>
        <th id="th2_a" onclick="setSort('a')">Achieved <span class="sort-arrow">‚Üï</span></th>
        <th id="th2_ratio" onclick="setSort('ratio')" class="active-sort">Conv % <span class="sort-arrow">‚Üì</span></th>
      </tr></thead>
      <tbody id="cnsltbody"></tbody>
    </table></div>
  </div>

  <div id="tab-process" class="section hidden"><div class="pgrid" id="procgrid"></div></div>

  <div id="tab-calendar" class="section hidden">
    <div class="cal-layout">
      <div class="card">
        <div class="cal-nav">
          <button class="cal-nav-btn" onclick="calNav(-1)">‚Äπ</button>
          <div><div class="cal-month" id="calmn"></div><div class="cal-yr" id="calyr"></div></div>
          <button class="cal-nav-btn" onclick="calNav(1)">‚Ä∫</button>
        </div>
        <div class="cal-grid" id="cgrid"></div>
        <div class="cal-legend">
          <div class="cal-leg"><div class="cal-leg-box" style="background:rgba(0,245,255,.07);border:1px solid rgba(0,245,255,.25)"></div>Has data</div>
          <div class="cal-leg"><div class="cal-leg-box" style="background:linear-gradient(135deg,var(--cyan),var(--blue))"></div>Selected</div>
        </div>
      </div>
      <div class="cal-side">
        <div class="card"><div class="card-title"><span class="ct-bar"></span>Week Ranges</div><div id="wkranges"></div></div>
        <div class="card" style="flex:1">
          <div class="card-title"><span class="ct-bar"></span>Selected ¬∑ <span id="selcnt">0</span></div>
          <div class="sel-scroll" id="sellist"></div>
          <button class="btn-clr" id="btnclr" onclick="clearSel()" style="display:none">‚úï Clear All</button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var SCRIPT_URL = "https://script.google.com/macros/s/AKfycbybjghaY0cQIEntgMiSGtOxz9uZD07ftDmrel5DCfHA_mf_kfiMXIqP7XrGC-5jVlv4/exec";
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

var ALL=[], FOPTS={}, CT="overview", SEL=new Set(), CM=0, CY=2025, SORT_KEY="ratio";
var MN=["January","February","March","April","May","June","July","August","September","October","November","December"];
var DN=["S","M","T","W","T","F","S"];
var MD=[31,28,28,31,30,31,30,31,31,30,31,30,31];
var MM={January:{r:[[1,11],[12,18],[19,25],[26,31]]},February:{r:[[1,7],[8,14],[15,21],[22,28]]},March:{r:[[1,7],[8,14],[15,21],[22,31]]},April:{r:[[1,7],[8,14],[15,21],[22,30]]},May:{r:[[1,7],[8,14],[15,21],[22,31]]},June:{r:[[1,7],[8,14],[15,21],[22,30]]}};
var MC={"Aasif":"#00f5ff","Aslam":"#a3e635","Deepesh":"#f472b6","Manas Ranjan Nayak":"#fbbf24"};
var PAL=["#00f5ff","#a3e635","#f472b6","#fbbf24","#4f8eff","#a855f7","#fb923c","#2dd4bf","#f87171","#38bdf8"];

/* ‚îÄ‚îÄ CACHE KEYS ‚îÄ‚îÄ */
var CACHE_KEY_DATA = "lpd_data_v2";
var CACHE_KEY_OPTS = "lpd_opts_v2";
var CACHE_TTL = 5 * 60 * 1000; // 5 min

function cacheGet(key) {
  try { var s = localStorage.getItem(key); if (!s) return null; var o = JSON.parse(s); if (Date.now() - o.ts > CACHE_TTL) return null; return o.data; } catch(e) { return null; }
}
function cacheSet(key, data) {
  try { localStorage.setItem(key, JSON.stringify({ts: Date.now(), data: data})); } catch(e) {}
}

/* ‚îÄ‚îÄ JSONP: fast, deduplicated ‚îÄ‚îÄ */
function jsonp(action, cb) {
  var fn = "_jp_" + action + "_" + Date.now();
  var done = false;
  var t = setTimeout(function(){ finish(new Error("Apps Script timeout. Tap Refresh to retry.")); }, 10000);
  function finish(err, data) {
    if (done) return; done = true;
    clearTimeout(t);
    delete window[fn];
    var el = document.getElementById(fn); if (el) el.remove();
    cb(err, data);
  }
  window[fn] = function(d) { finish(null, d); };
  var s = document.createElement("script");
  s.id = fn; s.async = true;
  s.src = SCRIPT_URL + "?action=" + action + "&callback=" + fn + "&t=" + Date.now();
  s.onerror = function() { finish(new Error("Cannot reach Apps Script. Check deployment URL.")); };
  document.head.appendChild(s);
}

/* ‚îÄ‚îÄ PROGRESS BAR (animated fake progress) ‚îÄ‚îÄ */
var _barVal = 0, _barTimer = null;
function setBar(pct) {
  _barVal = pct;
  var b = document.getElementById("lbar");
  if (b) b.style.width = Math.min(pct,100)+"%";
}
function startFakeProgress() {
  _barVal = 10; setBar(10);
  if (_barTimer) clearInterval(_barTimer);
  _barTimer = setInterval(function(){
    if (_barVal < 85) { _barVal += (_barVal < 40 ? 6 : _barVal < 70 ? 3 : 1); setBar(_barVal); }
  }, 200);
}
function stopFakeProgress() { if (_barTimer) { clearInterval(_barTimer); _barTimer = null; } }

function sm(t) { var e = document.getElementById("lmsg"); if (e) e.textContent = t; }
var _dotTimer = null;
function smStop() { if (_dotTimer) { clearInterval(_dotTimer); _dotTimer = null; } }

/* ‚îÄ‚îÄ HIDE LOADER ‚îÄ‚îÄ */
function hideLoader() {
  stopFakeProgress(); setBar(100);
  var el = document.getElementById("loader");
  setTimeout(function() {
    el.classList.add("fade-out");
    setTimeout(function() { el.style.display = "none"; el.classList.remove("fade-out"); }, 400);
  }, 180);
}

/* ‚îÄ‚îÄ SHOW ERROR ‚îÄ‚îÄ */
function showErr(msg) {
  var rbtn = document.getElementById("refreshBtn"); if (rbtn) { rbtn.disabled = false; rbtn.style.opacity = "1"; }
  var el = document.getElementById("errmsg");
  var testUrl = SCRIPT_URL + "?action=getLiveData&callback=test";
  el.innerHTML =
    "<strong style='font-size:15px'>‚ö† Cannot load data</strong><br><br>" +
    "<span style='color:#94a3b8'>" + msg + "</span><br><br>" +
    "<strong>Most likely cause:</strong> Apps Script not redeployed with new Code.gs<br><br>" +
    "<div style='text-align:left;background:rgba(0,0,0,.3);padding:14px 16px;border-radius:10px;margin-bottom:14px;font-size:12px;line-height:2'>" +
    "1. Open <a href='https://script.google.com' target='_blank' style='color:#00f5ff'>script.google.com</a><br>" +
    "2. Paste the new <strong>Code.gs</strong> ‚Üí Ctrl+S<br>" +
    "3. <strong>Deploy ‚Üí Manage Deployments ‚Üí ‚úè Edit ‚Üí New Version ‚Üí Deploy</strong><br>" +
    "4. Make sure <strong>Who has access = Anyone</strong>" +
    "</div>" +
    "<a href='" + testUrl + "' target='_blank' style='display:inline-block;margin-bottom:10px;padding:8px 16px;background:rgba(0,245,255,.1);border:1px solid rgba(0,245,255,.3);border-radius:8px;color:#00f5ff;font-weight:700;font-size:12px'>üîó Test Apps Script directly ‚Üí</a><br>" +
    "<button class='retry-btn' onclick='loadData()'>‚Üª Retry Connection</button>";
  el.style.display = "block";
}

/* ‚îÄ‚îÄ LOAD DATA: CACHE-FIRST + PARALLEL ‚îÄ‚îÄ */
window.addEventListener("DOMContentLoaded", function() {
  // Try to show cached data instantly
  var cachedData = cacheGet(CACHE_KEY_DATA);
  var cachedOpts = cacheGet(CACHE_KEY_OPTS);

  if (cachedData && cachedOpts && cachedData.ok && cachedOpts.ok) {
    // ‚ö° INSTANT ‚Äî show dashboard from cache immediately
    FOPTS = cachedOpts; fillF(cachedOpts);
    ALL = cachedData.rows || [];
    var rts = document.getElementById("rts");
hideLoader();
    go("overview");
    // Silently refresh in background
    fetchFresh(true);
  } else {
    loadData();
  }
});

function loadData() {
  var rbtn = document.getElementById("refreshBtn"); if (rbtn) { rbtn.disabled = true; rbtn.style.opacity = ".6"; }
  var loader = document.getElementById("loader");
  loader.style.display = "flex"; loader.style.opacity = "1";
  loader.classList.remove("fade-out");
  document.getElementById("errmsg").style.display = "none";
  startFakeProgress();
  fetchFresh(false);
}

function fetchFresh(silent) {
  var fopts = undefined, ldata = undefined;

  function tryDone() {
    if (fopts === undefined || ldata === undefined) return;
    if (!silent) {
      if (fopts && fopts._err) { showErr(fopts._err); return; }
      if (ldata && ldata._err) { showErr(ldata._err); return; }
      if (!fopts || !fopts.ok) { showErr((fopts && fopts.error) || "getFilterOptions failed. Redeploy Code.gs."); return; }
      if (!ldata || !ldata.ok) { showErr((ldata && ldata.error) || "getLiveData failed. Redeploy Code.gs."); return; }
    } else {
      // Silent ‚Äî ignore errors, just update if success
      if (!fopts || fopts._err || !fopts.ok) return;
      if (!ldata || ldata._err || !ldata.ok) return;
    }

    // Cache for next visit
    cacheSet(CACHE_KEY_OPTS, fopts);
    cacheSet(CACHE_KEY_DATA, ldata);

    FOPTS = fopts;
    if (!silent) fillF(fopts);
    ALL = ldata.rows || [];
smStop();
    var rbtn2 = document.getElementById("refreshBtn"); if (rbtn2) { rbtn2.disabled = false; rbtn2.style.opacity = "1"; }
    if (!silent) { hideLoader(); go("overview"); }
    else render(); // re-render with fresh data silently
  }

  // üî• Fire BOTH simultaneously
  jsonp("getFilterOptions", function(err, o) {
    fopts = err ? {_err: err.message} : o;
    tryDone();
  });
  jsonp("getLiveData", function(err, d) {
    ldata = err ? {_err: err.message} : d;
    tryDone();
  });
}

/* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
function fillF(o) {
  function add(id,a){ var s=document.getElementById(id); (a||[]).forEach(function(v){var op=document.createElement("option");op.value=v;op.textContent=v;s.appendChild(op);}); }
  add("fm",o.months); add("fmg",o.managers); add("fp",o.processes); add("fc",o.counsellors);
}
function onMonth() {
  var m=gv("fm"), ws=document.getElementById("fw");
  ws.innerHTML='<option value="">All Weeks</option>'; ws.disabled=!m;
  if(m&&FOPTS.weeksByMonth&&FOPTS.weeksByMonth[m]) FOPTS.weeksByMonth[m].forEach(function(w){var o=document.createElement("option");o.value=w;o.textContent=w;ws.appendChild(o);});
  render();
}
function onMgr() {
  var mg=gv("fmg"), cs=document.getElementById("fc");
  cs.innerHTML='<option value="">All Counsellors</option>';
  var l=mg?[...new Set(ALL.filter(function(d){return d.manager===mg;}).map(function(d){return d.counsellor;}))]:(FOPTS.counsellors||[]);
  l.sort().forEach(function(c){var o=document.createElement("option");o.value=c;o.textContent=c;cs.appendChild(o);});
  render();
}
function resetF(){ ["fm","fw","fmg","fp","fc"].forEach(function(id){document.getElementById(id).value="";}); document.getElementById("fw").disabled=true; render(); }
function gv(id){ return document.getElementById(id).value; }
function fd() {
  var m=gv("fm"),w=gv("fw"),mg=gv("fmg"),p=gv("fp"),c=gv("fc");
  return ALL.filter(function(d){ return(!m||d.month===m)&&(!w||d.week===w)&&(!mg||d.manager===mg)&&(!p||d.process===p)&&(!c||d.counsellor===c); });
}

/* ‚îÄ‚îÄ SORT ‚îÄ‚îÄ */
function setSort(key) {
  SORT_KEY = key;
  ["ratio","r","a"].forEach(function(k){
    var b=document.getElementById("sb_"+k); if(b) b.classList.toggle("on",k===key);
    ["th_","th2_"].forEach(function(p){
      var el=document.getElementById(p+k);
      if(el){ el.classList.toggle("active-sort",k===key); el.querySelector(".sort-arrow").textContent=k===key?"‚Üì":"‚Üï"; }
    });
  });
  render();
}

/* ‚îÄ‚îÄ AGGREGATE ‚îÄ‚îÄ */
function ag(data, key) {
  var map={};
  data.forEach(function(d){
    var k=d[key]; if(!k) return;
    if(!map[k]) map[k]={name:k,r:0,a:0,mgr:d.manager,tl:d.teamLeader,procs:{},mgrs:{}};
    map[k].r+=d.leadsReceived; map[k].a+=d.leadsAchieved;
    map[k].procs[d.process]=1; map[k].mgrs[d.manager]=1;
  });
  return Object.values(map).map(function(x){
    return Object.assign({},x,{
      procs:Object.keys(x.procs).filter(Boolean),
      mgrs:Object.keys(x.mgrs).filter(Boolean),
      ratio:x.r>0?((x.a/x.r)*100).toFixed(1):"0.0"
    });
  }).sort(function(a,b){ return +b[SORT_KEY]-+a[SORT_KEY]; });
}

/* ‚îÄ‚îÄ COUNTER ANIMATION ‚îÄ‚îÄ */
function countUp(el, target) {
  var start=0, dur=700, t0=null;
  function step(ts){ if(!t0)t0=ts; var p=Math.min((ts-t0)/dur,1), e=1-Math.pow(1-p,3); el.textContent=Math.round(start+(target-start)*e); if(p<1)requestAnimationFrame(step); else el.textContent=target; }
  requestAnimationFrame(step);
}

/* ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ */
function render() {
  var data=fd();
  var tR=data.reduce(function(s,d){return s+d.leadsReceived;},0);
  var tA=data.reduce(function(s,d){return s+d.leadsAchieved;},0);
  var cv=tR>0?((tA/tR)*100).toFixed(1):"0.0";
  var mgrs=ag(data,"manager");

  countUp(document.getElementById("kv1"),tR);
  countUp(document.getElementById("kv2"),tA);
  document.getElementById("kv3").textContent=cv+"%";
  countUp(document.getElementById("kv4"),mgrs.filter(function(m){return m.r>0;}).length);
  sv("ks1",data.length+" records");
  sv("ks4","of "+mgrs.length+" teams");

  if(CT==="overview")    rOv(data,mgrs,tR);
  if(CT==="managers")    rMg(data,mgrs);
  if(CT==="counsellors") rCn(data);
  if(CT==="process")     rPr(data);
  if(CT==="calendar")    rCal();
}

/* ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ */
function rOv(data,mgrs,tR) {
  var h="";
  mgrs.forEach(function(m){
    var c=MC[m.name]||"#888", pct=tR>0?(m.r/tR)*100:0, rc=+m.ratio>=40?"#10b981":"#f43f5e";
    h+='<div class="mbar">';
    h+='<div class="mbar-top"><span class="mbar-name"><span class="mbar-dot" style="background:'+c+'"></span>'+xe(m.name)+'</span>';
    h+='<span class="mbar-badges"><span class="bdg" style="background:'+c+'15;color:'+c+';border:1px solid '+c+'25">'+m.r+' rcv</span><span class="bdg" style="background:'+rc+'12;color:'+rc+';border:1px solid '+rc+'20">'+m.ratio+'%</span></span></div>';
    h+='<div class="track"><div class="track-fill" data-w="'+pct+'" style="width:0%;background:linear-gradient(90deg,'+c+','+c+'55)"></div>';
    h+='<div class="track-ach" data-w="'+m.ratio+'" style="width:0%;background:'+rc+';height:4px;top:2px;bottom:2px"></div></div></div>';
  });
  sv("mgrbars",h||nd());
  animBars(".track-fill[data-w],.track-ach[data-w]");

  var tm={};
  data.forEach(function(d){var k=d.month+"|"+d.week,wm=d.week.match(/Week \d+/),lbl=d.month.slice(0,3)+" "+(wm?wm[0]:d.week);if(!tm[k])tm[k]={l:lbl,r:0,a:0};tm[k].r+=d.leadsReceived;tm[k].a+=d.leadsAchieved;});
  var tr=Object.values(tm).filter(function(t){return t.r>0;}),mx=Math.max.apply(null,tr.map(function(t){return t.r;}).concat([1])),th="";
  tr.forEach(function(t,i){
    var c=PAL[i%PAL.length],cv2=t.r>0?((t.a/t.r)*100).toFixed(0):"0";
    th+='<div><div class="tc-label"><span>'+t.l+'</span><span><strong>'+t.r+'</strong> rcv ¬∑ <strong style="color:#a3e635">'+t.a+'</strong> ach ¬∑ <strong style="color:#00f5ff">'+cv2+'%</strong></span></div>';
    th+='<div class="tc-bar-wrap"><div class="tc-bar" data-w="'+(t.r/mx*100)+'" style="width:0%;background:linear-gradient(90deg,'+c+','+c+'44)"></div><div class="tc-ach" data-w="'+(t.a/mx*100)+'" style="width:0%"></div></div></div>';
  });
  sv("trend",th||nd());
  animBars(".tc-bar[data-w],.tc-ach[data-w]");

  var top=ag(data,"counsellor").filter(function(c){return c.r>0;}).slice(0,5),ch="";
  var medals=["ü•á","ü•à","ü•â","‚ë£","‚ë§"];
  top.forEach(function(c,i){
    var col=MC[c.mgr]||"#888";
    ch+='<div class="tc" style="background:'+col+'0c;border-color:'+col+'22">';
    ch+='<div class="tc-shine"></div>';
    ch+='<div class="tc-rank">'+medals[i]+' Rank #'+(i+1)+'</div>';
    ch+='<div class="tc-name">'+xe(c.name)+'</div>';
    ch+='<div class="tc-mgr" style="color:'+col+'99">'+xe(c.mgr)+'</div>';
    ch+='<div class="tc-num" style="color:'+col+'">'+c.r+'</div>';
    ch+='<div class="tc-cv">‚ñ≤ '+c.ratio+'% conv</div></div>';
  });
  sv("topcards",ch||nd());
}

/* ‚îÄ‚îÄ MANAGERS TABLE ‚îÄ‚îÄ */
function rMg(data,mgrs) {
  var h="";
  mgrs.forEach(function(m){
    var c=MC[m.name]||"#888",rc=+m.ratio>=40?"#10b981":"#f43f5e";
    var ps=m.procs.slice(0,3).map(function(p){return'<span class="bdg" style="background:rgba(255,255,255,.04);color:var(--muted);border:1px solid rgba(255,255,255,.07)">'+xe(p)+'</span>';}).join(" ");
    if(m.procs.length>3) ps+=' <span class="bdg" style="background:rgba(255,255,255,.04);color:var(--muted)">+'+(m.procs.length-3)+'</span>';
    h+='<tr><td><span style="display:inline-flex;align-items:center;gap:9px">';
    h+='<span style="width:10px;height:10px;border-radius:50%;background:'+c+';box-shadow:0 0 8px '+c+';display:inline-block;flex-shrink:0"></span>';
    h+=xe(m.name)+'</span></td>';
    h+='<td class="num-big" style="color:'+c+'">'+m.r+'</td>';
    h+='<td class="num-big" style="color:#a3e635">'+m.a+'</td>';
    h+='<td><span class="bdg" style="background:'+rc+'15;color:'+rc+';border:1px solid '+rc+'28;font-size:13px;padding:4px 14px">'+m.ratio+'%</span></td>';
    h+='<td><div class="cv-row"><div class="cv-track"><div class="cv-fill" style="width:'+Math.min(+m.ratio,100)+'%;background:linear-gradient(90deg,'+c+',#10b981)"></div></div></div></td>';
    h+='<td>'+ps+'</td></tr>';
  });
  sv("mgrtbody",h);
}

/* ‚îÄ‚îÄ COUNSELLORS TABLE ‚îÄ‚îÄ */
function rCn(data) {
  var stats=ag(data,"counsellor"),h="";
  stats.forEach(function(c,i){
    var col=MC[c.mgr]||"#888",rc=+c.ratio>=40?"#10b981":"#f43f5e";
    h+='<tr>';
    h+='<td><span class="rank-pill">'+(i+1)+'</span></td>';
    h+='<td style="font-weight:800">'+xe(c.name)+'</td>';
    h+='<td><span class="bdg" style="background:'+col+'15;color:'+col+';border:1px solid '+col+'25">'+xe(c.mgr)+'</span></td>';
    h+='<td style="color:var(--muted);font-size:12px">'+xe(c.tl||"‚Äî")+'</td>';
    h+='<td class="num-big" style="color:'+col+'">'+c.r+'</td>';
    h+='<td class="num-big" style="color:#a3e635">'+c.a+'</td>';
    h+='<td><div class="cv-row"><div class="cv-track"><div class="cv-fill" style="width:'+Math.min(+c.ratio,100)+'%;background:'+rc+'"></div></div>';
    h+='<span style="font-size:12px;font-weight:800;color:'+rc+';min-width:42px">'+c.ratio+'%</span></div></td></tr>';
  });
  sv("cnsltbody",h);
}

/* ‚îÄ‚îÄ PROCESS ‚îÄ‚îÄ */
function rPr(data) {
  var stats=ag(data,"process"),mx=Math.max.apply(null,stats.map(function(s){return s.r;}).concat([1])),h="";
  stats.forEach(function(p,i){
    var c=PAL[i%PAL.length],rc=+p.ratio>=40?"#10b981":"#f43f5e";
    h+='<div class="pc" style="border-color:'+c+'20">';
    h+='<div class="pc-glow" style="background:'+c+'"></div>';
    h+='<div class="pc-head"><div class="pc-title">'+xe(p.name)+'</div>';
    h+='<span class="bdg" style="background:'+rc+'12;color:'+rc+';border:1px solid '+rc+'28;font-size:12px;padding:4px 13px">'+p.ratio+'%</span></div>';
    h+='<div class="pc-nums">';
    h+='<div><div class="pc-lbl">Received</div><div class="pc-val" style="color:'+c+'">'+p.r+'</div></div>';
    h+='<div><div class="pc-lbl">Achieved</div><div class="pc-val" style="color:#a3e635">'+p.a+'</div></div>';
    h+='<div><div class="pc-lbl">Counsellors</div><div style="font-size:22px;font-weight:900">'+p.procs.length+'</div></div>';
    h+='<div><div class="pc-lbl">Managers</div><div style="font-size:22px;font-weight:900">'+p.mgrs.length+'</div></div>';
    h+='</div>';
    h+='<div class="pc-prog"><div class="pc-prog-fill" style="width:'+(p.r/mx*100)+'%;background:linear-gradient(90deg,'+c+','+c+'44)"></div></div></div>';
  });
  sv("procgrid",h||nd());
}

/* ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ */
function rCal() {
  var mn=MN[CM]; sv("calmn",mn); sv("calyr",CY);
  var meta=MM[mn],act=new Set();
  if(meta) meta.r.forEach(function(r){for(var d=r[0];d<=r[1];d++)act.add(d);});
  var fd2=new Date(CY,CM,1).getDay(),dim=MD[CM];
  var h=DN.map(function(d){return'<div class="cal-dh">'+d+'</div>';}).join("");
  for(var i=0;i<fd2;i++) h+='<div class="cal-day empty"></div>';
  for(var day=1;day<=dim;day++){
    var key=CY+"-"+CM+"-"+day,isSel=SEL.has(key),isAct=act.has(day);
    var cls="cal-day"+(isSel?" sel":isAct?" has":"");
    h+='<div class="'+cls+'" onclick="tD('+day+')" title="'+(wkD(mn,day)||"")+'">'+day+(isAct&&!isSel?'<span class="cal-dot"></span>':"")+' </div>';
  }
  sv("cgrid",h);
  var wh="";
  if(meta) meta.r.forEach(function(r,i){wh+='<div class="wk-item"><div class="wk-name">Week '+(i+1)+'</div><div class="wk-dates">'+r[0]+' ‚Äì '+r[1]+' '+mn+'</div></div>';});
  else wh='<div style="color:var(--muted);font-size:12px;font-weight:600">No week data for this month</div>';
  sv("wkranges",wh);
  var sel=[...SEL].sort(); sv("selcnt",sel.length);
  document.getElementById("btnclr").style.display=sel.length?"":"none";
  var sh=sel.map(function(k){var p=k.split("-");return'<div class="sel-item"><span>'+(MN[+p[1]]||p[1])+' '+p[2]+', '+p[0]+'</span><button class="sel-rm" onclick="rD(\''+k+'\')">&times;</button></div>';}).join("");
  sv("sellist",sh||'<div style="color:var(--muted);font-size:12px;font-weight:600;text-align:center;padding:18px 0">Click calendar days to select</div>');
}
function wkD(mn,d){var m=MM[mn];if(!m)return null;var i=m.r.findIndex(function(r){return d>=r[0]&&d<=r[1];});return i>=0?"Week "+(i+1):null;}
function tD(d){var k=CY+"-"+CM+"-"+d;SEL.has(k)?SEL.delete(k):SEL.add(k);rCal();}
function rD(k){SEL.delete(k);rCal();}
function clearSel(){SEL.clear();rCal();}
function calNav(dir){CM+=dir;if(CM<0){CM=11;CY--;}else if(CM>11){CM=0;CY++;}rCal();}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
function go(t){
  document.querySelectorAll("[id^='tab-']").forEach(function(el){el.classList.add("hidden");});
  document.getElementById("tab-"+t).classList.remove("hidden");
  document.querySelectorAll(".tab").forEach(function(b){b.classList.toggle("on",b.getAttribute("onclick").indexOf("'"+t+"'")>=0);});
  CT=t; render();
}

/* ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ */
function animBars(sel){ setTimeout(function(){ document.querySelectorAll(sel).forEach(function(el){el.style.width=Math.min(+el.dataset.w,100)+"%";}); },50); }
function sv(id,v){var el=document.getElementById(id);if(el)el.innerHTML=v;}
function nd(){return'<div class="nodata">No data for current filters</div>';}
function xe(s){var d=document.createElement("div");d.textContent=s||"";return d.innerHTML;}
</script>
</body>
</html>
